{% extends "admin/change_form.html" %}
{% load i18n %}

{% block extrahead %}
{{ block.super }}
<!-- Set referrer policy for TinyMCE Cloud -->
<meta name="referrer" content="origin">

{% if tinymce_config %}
<!-- TinyMCE -->
<script src="{{ tinymce_js_url }}" referrerpolicy="origin"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Find the content textarea
        const contentTextarea = document.querySelector('textarea[name="content"]');
        if (contentTextarea) {
            tinymce.init({
                selector: 'textarea[name="content"]',
                height: {{ tinymce_config.height }},
                menubar: '{{ tinymce_config.menubar }}',
                plugins: [
                    {% for plugin in tinymce_config.plugins %}'{{ plugin }}'{% if not forloop.last %}, {% endif %}{% endfor %}
                ],
                toolbar: '{{ tinymce_config.toolbar }}',
                content_css: 'default',
                relative_urls: false,
                remove_script_host: false,
                convert_urls: true,
                branding: false,
                promotion: false,
                referrer_policy: 'origin',
                {% if cloudinary_upload_url %}
                images_upload_url: '{{ cloudinary_upload_url }}',
                automatic_uploads: true,
                file_picker_types: 'image',
                {% endif %}
            });
        }

        // Also init for newsletter content if present
        const newsletterTextarea = document.querySelector('textarea[name="content"]');
        if (newsletterTextarea && !contentTextarea) {
            tinymce.init({
                selector: 'textarea[name="content"]',
                height: {{ tinymce_config.height }},
                menubar: '{{ tinymce_config.menubar }}',
                plugins: [
                    {% for plugin in tinymce_config.plugins %}'{{ plugin }}'{% if not forloop.last %}, {% endif %}{% endfor %}
                ],
                toolbar: '{{ tinymce_config.toolbar }}',
                content_css: 'default',
                relative_urls: false,
                branding: false,
                promotion: false,
            });
        }
    });
</script>
{% endif %}
{% endblock %}
